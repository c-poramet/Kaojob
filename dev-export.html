<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      min-height: max(884px, 100dvh);
    }
    
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .animate-fade-in-up {
      animation: fadeInUp 0.6s ease-out forwards;
      opacity: 0;
    }
  </style>
  <meta charset="utf-8"/>
  <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
  <link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Public+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
  <title>Developer Export - KaoJob</title>
  <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <style type="text/tailwindcss">
    :root {
      --primary-50: #f0fdf4;
      --primary-100: #dcfce7;
      --primary-200: #bbf7d0;
      --primary-300: #86efac;
      --primary-400: #4ade80;
      --primary-500: #22c55e;
      --primary-600: #16a34a;
      --primary-700: #15803d;
      --primary-800: #166534;
      --primary-900: #14532d;
      --primary-950: #052e16;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden" style='font-family: "Public Sans", "Noto Sans", sans-serif;'>
    <header class="flex items-center bg-white p-4 justify-between sticky top-0 z-20 shadow-sm">
      <a class="text-xl font-bold text-gray-800" href="index.html">KaoJob</a>
      <div class="flex items-center space-x-4">
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
          <span class="material-symbols-outlined text-xs mr-1">code</span>
          Dev Mode
        </span>
        <button class="flex items-center justify-center rounded-md h-10 w-10 bg-transparent text-gray-700" onclick="toggleMobileMenu()">
          <span class="material-symbols-outlined">menu</span>
        </button>
      </div>
      
      <div id="mobile-menu" class="hidden absolute top-16 right-4 bg-white rounded-lg shadow-lg p-4 z-30">
        <nav class="flex flex-col space-y-2">
          <a class="text-gray-700 hover:text-green-600 px-3 py-2" href="index.html">Home</a>
          <a class="text-gray-700 hover:text-green-600 px-3 py-2" href="jobs.html">Jobs</a>
          <a class="text-gray-700 hover:text-green-600 px-3 py-2" href="post-job.html">Post a Job</a>
          <a class="text-gray-700 hover:text-green-600 px-3 py-2" href="register.html">Register</a>
          <a class="text-gray-700 hover:text-green-600 px-3 py-2" href="contact.html">Contact</a>
        </nav>
      </div>
    </header>

    <main class="flex-grow bg-gray-100 py-8 px-4 sm:px-6 lg:px-8">
      <div class="max-w-6xl mx-auto">
        <!-- Navigation Breadcrumb -->
        <nav class="flex items-center space-x-2 text-sm mb-6" aria-label="Breadcrumb">
          <a href="index.html" class="text-gray-500 hover:text-gray-700 flex items-center">
            <span class="material-symbols-outlined text-sm mr-1">home</span>
            Home
          </a>
          <span class="text-gray-400">/</span>
          <span class="text-gray-900 font-medium">Developer Export</span>
        </nav>

        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8">
          <div>
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">Developer Export</h1>
            <p class="text-gray-600">Export job data for API integrations, Line Bot, and external services</p>
          </div>
          <div class="mt-4 lg:mt-0 flex flex-wrap gap-2">
            <button onclick="goBack()" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors">
              <span class="material-symbols-outlined text-sm mr-2">arrow_back</span>
              Back
            </button>
          </div>
        </div>

        <!-- Export Controls -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div>
              <label for="export-format" class="block text-sm font-medium text-gray-700 mb-2">Export Format</label>
              <select id="export-format" class="block w-full py-2 px-3 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                <option value="api">API Format (Clean)</option>
                <option value="line-bot">Line Bot Format</option>
                <option value="raw">Raw Database Format</option>
                <option value="csv">CSV Format</option>
              </select>
            </div>
            
            <div>
              <label for="status-filter" class="block text-sm font-medium text-gray-700 mb-2">Job Status</label>
              <select id="status-filter" class="block w-full py-2 px-3 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                <option value="all">All Statuses</option>
                <option value="Active">Active Only</option>
                <option value="Closed">Closed Only</option>
                <option value="Draft">Draft Only</option>
              </select>
            </div>

            <div>
              <label for="location-filter" class="block text-sm font-medium text-gray-700 mb-2">Location</label>
              <select id="location-filter" class="block w-full py-2 px-3 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                <option value="">All Locations</option>
                <option value="Bangkok">Bangkok</option>
                <option value="Chiang Mai">Chiang Mai</option>
                <option value="Phuket">Phuket</option>
                <option value="Pattaya">Pattaya</option>
              </select>
            </div>

            <div>
              <label for="work-type-filter" class="block text-sm font-medium text-gray-700 mb-2">Work Type</label>
              <select id="work-type-filter" class="block w-full py-2 px-3 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                <option value="">All Types</option>
                <option value="Full-time">Full-time</option>
                <option value="Part-time">Part-time</option>
                <option value="Freelance">Freelance</option>
                <option value="Contract">Contract</option>
              </select>
            </div>
          </div>

          <div class="flex flex-wrap gap-3">
            <button onclick="generatePreview()" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors">
              <span class="material-symbols-outlined text-sm mr-2">preview</span>
              Preview Export
            </button>
            <button onclick="downloadJSON()" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 transition-colors">
              <span class="material-symbols-outlined text-sm mr-2">download</span>
              Download JSON
            </button>
            <button onclick="copyToClipboard()" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
              <span class="material-symbols-outlined text-sm mr-2">content_copy</span>
              Copy to Clipboard
            </button>
            <button onclick="generateAPIEndpoint()" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 transition-colors">
              <span class="material-symbols-outlined text-sm mr-2">api</span>
              Generate API Mock
            </button>
            <button onclick="debugLocalStorage()" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 transition-colors">
              <span class="material-symbols-outlined text-sm mr-2">bug_report</span>
              Debug Storage
            </button>
          </div>
        </div>

        <!-- Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0">
                <span class="material-symbols-outlined text-2xl text-green-600">work</span>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-500">Total Jobs</p>
                <p class="text-2xl font-semibold text-gray-900" id="total-jobs">0</p>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0">
                <span class="material-symbols-outlined text-2xl text-blue-600">visibility</span>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-500">Active Jobs</p>
                <p class="text-2xl font-semibold text-gray-900" id="active-jobs">0</p>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0">
                <span class="material-symbols-outlined text-2xl text-purple-600">send</span>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-500">Total Applications</p>
                <p class="text-2xl font-semibold text-gray-900" id="total-applications">0</p>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0">
                <span class="material-symbols-outlined text-2xl text-orange-600">business</span>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-500">Unique Employers</p>
                <p class="text-2xl font-semibold text-gray-900" id="unique-employers">0</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Export Preview -->
        <div class="bg-white rounded-lg shadow-sm overflow-hidden mb-8">
          <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-medium text-gray-900">Export Preview</h3>
              <div class="flex items-center space-x-2">
                <span class="text-sm text-gray-500" id="preview-count">0 jobs</span>
                <button onclick="formatJSON()" class="text-sm text-blue-600 hover:text-blue-800">Format JSON</button>
              </div>
            </div>
          </div>
          <div class="p-6">
            <pre id="export-preview" class="bg-gray-50 rounded-lg p-4 text-sm overflow-x-auto min-h-[200px] font-mono text-gray-800">Click "Preview Export" to see the exported data format...</pre>
          </div>
        </div>

        <!-- API Documentation -->
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h3 class="text-lg font-medium text-gray-900 mb-4">API Integration Examples</h3>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
              <h4 class="text-md font-medium text-gray-800 mb-2">Line Bot Integration</h4>
              <pre class="bg-gray-900 text-green-400 rounded-lg p-4 text-sm overflow-x-auto"><code>// Line Bot Message Format
const jobs = await fetch('/api/jobs').then(r => r.json());
const message = {
  type: 'flex',
  altText: 'Available Jobs',
  contents: {
    type: 'carousel',
    contents: jobs.map(job => ({
      type: 'bubble',
      body: {
        type: 'box',
        layout: 'vertical',
        contents: [
          {
            type: 'text',
            text: job.title,
            weight: 'bold',
            size: 'xl'
          },
          {
            type: 'text',
            text: job.company,
            margin: 'md'
          }
        ]
      }
    }))
  }
};</code></pre>
            </div>

            <div>
              <h4 class="text-md font-medium text-gray-800 mb-2">REST API Usage</h4>
              <pre class="bg-gray-900 text-blue-400 rounded-lg p-4 text-sm overflow-x-auto"><code>// Fetch jobs with filters
GET /api/jobs?status=Active&location=Bangkok

// Response format
{
  "success": true,
  "data": [
    {
      "id": "job_123",
      "title": "Software Developer",
      "company": "Tech Corp",
      "location": "Bangkok",
      "salary": "50000-70000",
      "type": "Full-time",
      "posted": "2024-09-24T10:00:00Z"
    }
  ],
  "total": 1
}</code></pre>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="bg-white border-t border-gray-200">
      <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <nav class="flex justify-center space-x-6 mb-4">
          <a class="text-gray-500 hover:text-gray-700" href="index.html">Home</a>
          <a class="text-gray-500 hover:text-gray-700" href="jobs.html">Jobs</a>
          <a class="text-gray-500 hover:text-gray-700" href="post-job.html">Post a Job</a>
          <a class="text-gray-500 hover:text-gray-700" href="register.html">Register</a>
          <a class="text-gray-500 hover:text-gray-700" href="contact.html">Contact</a>
        </nav>
        <p class="text-center text-base text-gray-400">© 2024 KaoJob. All rights reserved.</p>
      </div>
    </footer>
  </div>

  <script>
    // Database functions (reused from jobs.html)
    function getJobsFromDatabase() {
      return JSON.parse(localStorage.getItem('kaoJobJobs') || '[]');
    }

    function getApplicationsFromDatabase() {
      return JSON.parse(localStorage.getItem('kaoJobApplications') || '[]');
    }

    // Initialize sample jobs if database is empty (same as jobs.html)
    function initializeSampleJobs() {
      const existingJobs = getJobsFromDatabase();
      if (existingJobs.length === 0) {
        console.log('Initializing sample jobs in localStorage...');
        const sampleJobs = [
          {
            id: 'job_sample_1',
            title: 'Barista',
            description: 'Looking for an experienced barista to join our team. Must have knowledge of coffee brewing techniques and excellent customer service skills.',
            employerId: 'emp_sample_1',
            employerName: 'Coffee Corner',
            location: 'Bangkok',
            workType: 'Part-time',
            salary: '฿15,000 - ฿18,000/month',
            contactInfo: 'jobs@coffeecorner.com',
            status: 'Active',
            datePosted: new Date().toISOString(),
            applications: []
          },
          {
            id: 'job_sample_2',
            title: 'Office Assistant',
            description: 'Seeking a reliable office assistant to handle administrative tasks, filing, and customer support. Computer skills required.',
            employerId: 'emp_sample_2',
            employerName: 'Business Solutions Ltd',
            location: 'Bangkok',
            workType: 'Full-time',
            salary: '฿20,000/month',
            contactInfo: 'hr@businesssolutions.com',
            status: 'Active',
            datePosted: new Date().toISOString(),
            applications: []
          },
          {
            id: 'job_sample_3',
            title: 'Gardener',
            description: 'Experienced gardener needed for maintaining residential gardens. Knowledge of plant care and landscaping preferred.',
            employerId: 'emp_sample_3',
            employerName: 'Green Thumb Services',
            location: 'Chiang Mai',
            workType: 'Freelance',
            salary: '฿500/day',
            contactInfo: 'contact@greenthumb.com',
            status: 'Active',
            datePosted: new Date().toISOString(),
            applications: []
          },
          {
            id: 'job_sample_4',
            title: 'Software Developer',
            description: 'Join our tech team as a full-stack developer. Experience with React, Node.js, and databases required. Work on exciting projects with modern technologies.',
            employerId: 'emp_sample_4',
            employerName: 'TechStart Co.',
            location: 'Bangkok',
            workType: 'Full-time',
            salary: '฿45,000 - ฿65,000/month',
            contactInfo: 'careers@techstart.com',
            status: 'Active',
            datePosted: new Date().toISOString(),
            applications: []
          },
          {
            id: 'job_sample_5',
            title: 'Marketing Coordinator',
            description: 'Looking for a creative marketing coordinator to manage social media campaigns, content creation, and event planning.',
            employerId: 'emp_sample_5',
            employerName: 'Creative Agency',
            location: 'Phuket',
            workType: 'Contract',
            salary: '฿25,000 - ฿35,000/month',
            contactInfo: 'hr@creativeagency.com',
            status: 'Active',
            datePosted: new Date().toISOString(),
            applications: []
          }
        ];
        
        localStorage.setItem('kaoJobJobs', JSON.stringify(sampleJobs));
        console.log('Sample jobs initialized:', sampleJobs.length, 'jobs added');
      } else {
        console.log('Found existing jobs in localStorage:', existingJobs.length, 'jobs');
      }
    }

    // Export format transformers
    function transformToAPIFormat(jobs) {
      return {
        success: true,
        data: jobs.map(job => ({
          id: job.id,
          title: job.title,
          description: job.description,
          company: job.employerName,
          location: job.location,
          workType: job.workType,
          salary: job.salary,
          contactEmail: job.contactInfo,
          status: job.status,
          datePosted: job.datePosted,
          applicationCount: job.applications ? job.applications.length : 0
        })),
        total: jobs.length,
        timestamp: new Date().toISOString()
      };
    }

    function transformToLineBotFormat(jobs) {
      return {
        type: 'flex',
        altText: `${jobs.length} Job Opportunities Available`,
        contents: {
          type: 'carousel',
          contents: jobs.slice(0, 10).map(job => ({
            type: 'bubble',
            header: {
              type: 'box',
              layout: 'vertical',
              contents: [
                {
                  type: 'text',
                  text: job.title,
                  weight: 'bold',
                  size: 'xl',
                  color: '#1DB584'
                }
              ]
            },
            body: {
              type: 'box',
              layout: 'vertical',
              spacing: 'md',
              contents: [
                {
                  type: 'text',
                  text: job.employerName,
                  size: 'md',
                  color: '#666666'
                },
                {
                  type: 'box',
                  layout: 'vertical',
                  margin: 'lg',
                  spacing: 'sm',
                  contents: [
                    {
                      type: 'box',
                      layout: 'baseline',
                      spacing: 'sm',
                      contents: [
                        {
                          type: 'text',
                          text: 'Location',
                          color: '#aaaaaa',
                          size: 'sm',
                          flex: 2
                        },
                        {
                          type: 'text',
                          text: job.location,
                          wrap: true,
                          color: '#666666',
                          size: 'sm',
                          flex: 5
                        }
                      ]
                    },
                    {
                      type: 'box',
                      layout: 'baseline',
                      spacing: 'sm',
                      contents: [
                        {
                          type: 'text',
                          text: 'Type',
                          color: '#aaaaaa',
                          size: 'sm',
                          flex: 2
                        },
                        {
                          type: 'text',
                          text: job.workType,
                          wrap: true,
                          color: '#666666',
                          size: 'sm',
                          flex: 5
                        }
                      ]
                    },
                    {
                      type: 'box',
                      layout: 'baseline',
                      spacing: 'sm',
                      contents: [
                        {
                          type: 'text',
                          text: 'Salary',
                          color: '#aaaaaa',
                          size: 'sm',
                          flex: 2
                        },
                        {
                          type: 'text',
                          text: job.salary,
                          wrap: true,
                          color: '#666666',
                          size: 'sm',
                          flex: 5
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            footer: {
              type: 'box',
              layout: 'vertical',
              spacing: 'sm',
              contents: [
                {
                  type: 'button',
                  style: 'primary',
                  height: 'sm',
                  action: {
                    type: 'postback',
                    label: 'Apply Now',
                    data: `action=apply&jobId=${job.id}`
                  }
                },
                {
                  type: 'button',
                  style: 'link',
                  height: 'sm',
                  action: {
                    type: 'postback',
                    label: 'View Details',
                    data: `action=details&jobId=${job.id}`
                  }
                }
              ]
            }
          }))
        }
      };
    }

    function transformToCSV(jobs) {
      const headers = ['ID', 'Title', 'Company', 'Description', 'Location', 'Work Type', 'Salary', 'Contact', 'Status', 'Date Posted', 'Applications'];
      const rows = jobs.map(job => [
        job.id,
        `"${job.title}"`,
        `"${job.employerName}"`,
        `"${job.description.replace(/"/g, '""')}"`,
        job.location,
        job.workType,
        `"${job.salary}"`,
        job.contactInfo,
        job.status,
        job.datePosted,
        job.applications ? job.applications.length : 0
      ]);
      
      return [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
    }

    // Main export functions
    function getFilteredJobs() {
      const jobs = getJobsFromDatabase();
      console.log('Raw jobs from database:', jobs.length);
      
      const statusFilter = document.getElementById('status-filter').value;
      const locationFilter = document.getElementById('location-filter').value;
      const workTypeFilter = document.getElementById('work-type-filter').value;

      const filtered = jobs.filter(job => {
        const matchesStatus = statusFilter === 'all' || job.status === statusFilter;
        const matchesLocation = !locationFilter || job.location === locationFilter;
        const matchesWorkType = !workTypeFilter || job.workType === workTypeFilter;
        
        return matchesStatus && matchesLocation && matchesWorkType;
      });
      
      console.log('Filtered jobs:', filtered.length, 'filters:', { statusFilter, locationFilter, workTypeFilter });
      return filtered;
    }

    function generatePreview() {
      const jobs = getFilteredJobs();
      const format = document.getElementById('export-format').value;
      const preview = document.getElementById('export-preview');
      const countEl = document.getElementById('preview-count');
      
      console.log('Generating preview for', jobs.length, 'jobs in format:', format);
      
      let exportData;
      
      switch(format) {
        case 'api':
          exportData = transformToAPIFormat(jobs);
          break;
        case 'line-bot':
          exportData = transformToLineBotFormat(jobs);
          break;
        case 'csv':
          preview.textContent = transformToCSV(jobs);
          countEl.textContent = `${jobs.length} jobs`;
          return;
        case 'raw':
        default:
          exportData = jobs;
          break;
      }
      
      preview.textContent = JSON.stringify(exportData, null, 2);
      countEl.textContent = `${jobs.length} jobs`;
    }

    function downloadJSON() {
      const jobs = getFilteredJobs();
      const format = document.getElementById('export-format').value;
      let exportData, filename;
      
      switch(format) {
        case 'api':
          exportData = transformToAPIFormat(jobs);
          filename = 'kaojob-api-export.json';
          break;
        case 'line-bot':
          exportData = transformToLineBotFormat(jobs);
          filename = 'kaojob-linebot-export.json';
          break;
        case 'csv':
          const csvData = transformToCSV(jobs);
          const csvBlob = new Blob([csvData], { type: 'text/csv' });
          downloadBlob(csvBlob, 'kaojob-export.csv');
          showMessage('CSV file downloaded successfully!', 'success');
          return;
        case 'raw':
        default:
          exportData = jobs;
          filename = 'kaojob-raw-export.json';
          break;
      }
      
      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
      downloadBlob(blob, filename);
      showMessage('JSON file downloaded successfully!', 'success');
    }

    function downloadBlob(blob, filename) {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;  
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function copyToClipboard() {
      const preview = document.getElementById('export-preview');
      const textArea = document.createElement('textarea');
      textArea.value = preview.textContent;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      showMessage('Export data copied to clipboard!', 'success');
    }

    function generateAPIEndpoint() {
      const jobs = getFilteredJobs();
      const apiData = transformToAPIFormat(jobs);
      
      // Create a simple mock API endpoint
      const mockEndpoint = `data:application/json;charset=utf-8,${encodeURIComponent(JSON.stringify(apiData, null, 2))}`;
      
      showMessage('Mock API endpoint generated! Check browser console for details.', 'info');
      console.log('Mock API Endpoint:', mockEndpoint);
      console.log('Usage: You can use this data URL as a mock API endpoint for testing');
      console.log('API Response:', apiData);
    }

    function debugLocalStorage() {
      console.log('=== DEBUG: LocalStorage Contents ===');
      console.log('Jobs in localStorage:', localStorage.getItem('kaoJobJobs'));
      console.log('Applications in localStorage:', localStorage.getItem('kaoJobApplications'));
      console.log('User session:', localStorage.getItem('kaoJobUser'));
      
      const jobs = getJobsFromDatabase();
      const applications = getApplicationsFromDatabase();
      
      console.log('Parsed jobs:', jobs);
      console.log('Parsed applications:', applications);
      console.log('Jobs count:', jobs.length);
      console.log('Applications count:', applications.length);
      
      if (jobs.length === 0) {
        console.log('No jobs found - reinitializing sample jobs...');
        initializeSampleJobs();
        console.log('After reinitialization:', getJobsFromDatabase().length, 'jobs');
      }
      
      showMessage(`Debug complete! Found ${jobs.length} jobs, ${applications.length} applications. Check console for details.`, 'info');
      
      // Refresh the display
      updateStatistics();
      generatePreview();
    }

    function updateStatistics() {
      const jobs = getJobsFromDatabase();
      const applications = getApplicationsFromDatabase();
      const activeJobs = jobs.filter(job => job.status === 'Active');
      const uniqueEmployers = [...new Set(jobs.map(job => job.employerId))];
      
      document.getElementById('total-jobs').textContent = jobs.length;
      document.getElementById('active-jobs').textContent = activeJobs.length;
      document.getElementById('total-applications').textContent = applications.length;
      document.getElementById('unique-employers').textContent = uniqueEmployers.length;
    }

    function formatJSON() {
      const preview = document.getElementById('export-preview');
      try {
        const parsed = JSON.parse(preview.textContent);
        preview.textContent = JSON.stringify(parsed, null, 2);
      } catch (e) {
        showMessage('Invalid JSON format', 'error');
      }
    }

    function toggleMobileMenu() {
      const menu = document.getElementById('mobile-menu');
      menu.classList.toggle('hidden');
    }

    function goBack() {
      window.history.back();
    }

    function showMessage(text, type = 'success') {
      const messageDiv = document.createElement('div');
      let bgColor;
      switch(type) {
        case 'error':
          bgColor = 'bg-red-500';
          break;
        case 'info':
          bgColor = 'bg-blue-500';
          break;
        default:
          bgColor = 'bg-green-500';
      }
      messageDiv.className = `fixed top-20 left-1/2 transform -translate-x-1/2 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-md text-center`;
      messageDiv.textContent = text;
      document.body.appendChild(messageDiv);
      
      setTimeout(() => {
        messageDiv.remove();
      }, 4000);
    }

    // Initialize page
    window.addEventListener('load', function() {
      // Initialize sample jobs if database is empty (ensures data persistence)
      initializeSampleJobs();
      
      // Update UI with current data
      updateStatistics();
      generatePreview();
      
      // Add event listeners for filters
      document.getElementById('export-format').addEventListener('change', generatePreview);
      document.getElementById('status-filter').addEventListener('change', generatePreview);
      document.getElementById('location-filter').addEventListener('change', generatePreview);
      document.getElementById('work-type-filter').addEventListener('change', generatePreview);
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', function(event) {
      const menu = document.getElementById('mobile-menu');
      const menuButton = event.target.closest('button');
      
      if (!menu.contains(event.target) && !menuButton) {
        menu.classList.add('hidden');
      }
    });
  </script>
</body>
</html>