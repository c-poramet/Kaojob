<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Public+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
<title>Post a Job - KaoJob</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<style type="text/tailwindcss">
      :root {
        --primary-50: #f0fdf4;
        --primary-100: #dcfce7;
        --primary-200: #bbf7d0;
        --primary-300: #86efac;
        --primary-400: #4ade80;
        --primary-500: #22c55e;
        --primary-600: #16a34a;
        --primary-700: #15803d;
        --primary-800: #166534;
        --primary-900: #14532d;
        --primary-950: #052e16;
      }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
    <script>
    (async function() {
      const current = location.pathname.split('/').pop() || 'index.html';
      if (current === 'login.html' || current === 'register.html') return;
      const token = localStorage.getItem('kaoJobToken');
      if (!token) {
        localStorage.removeItem('kaoJobUser');
        location.href = 'login.html';
        return;
      }
      try {
        const res = await fetch('/api/me', { headers: { 'Authorization': 'Bearer ' + token } });
        if (!res.ok) {
          localStorage.removeItem('kaoJobToken');
          localStorage.removeItem('kaoJobUser');
          location.href = 'login.html';
          return;
        }
        const body = await res.json();
        if (body && body.user) localStorage.setItem('kaoJobUser', JSON.stringify(body.user));
      } catch (e) {
        localStorage.removeItem('kaoJobToken');
        localStorage.removeItem('kaoJobUser');
        location.href = 'login.html';
        return;
      }
    })();
    </script>
  </head>
<body class="bg-gray-50">
<div class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden" style='font-family: "Public Sans", "Noto Sans", sans-serif;'>
<header class="flex items-center bg-white p-4 justify-between sticky top-0 z-20 shadow-sm">
<a class="text-xl font-bold text-gray-800" href="index.html">KaoJob</a>
<button class="flex items-center justify-center rounded-md h-10 w-10 bg-transparent text-gray-700" onclick="toggleMobileMenu()">
<span class="material-symbols-outlined">
              menu
            </span>
</button>
<div id="mobile-menu" class="hidden absolute top-16 right-4 bg-white rounded-lg shadow-lg p-4 z-30">
<nav class="flex flex-col space-y-2">
<a class="text-gray-700 hover:text-green-600 px-3 py-2" href="index.html">Home</a>
<a class="text-gray-700 hover:text-green-600 px-3 py-2" href="jobs.html">Jobs</a>
<a class="text-gray-700 hover:text-green-600 px-3 py-2" href="post-job.html">Post a Job</a>
<a class="text-gray-700 hover:text-green-600 px-3 py-2" href="register.html">Register</a>
<a class="text-gray-700 hover:text-green-600 px-3 py-2" href="contact.html">Contact</a>
</nav>
</div>
</header>
<main class="flex-grow bg-gray-100 py-8 px-4">
<div class="max-w-lg mx-auto bg-white rounded-xl shadow-md p-6 sm:p-8">
<h1 class="text-3xl font-bold text-gray-900 mb-6 text-center">Post a New Job</h1>
<form onsubmit="handleJobSubmit(event)" class="space-y-6">
<div>
<label class="sr-only" for="job-title">Job Title</label>
<div class="relative">
<div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
<span class="material-symbols-outlined text-gray-400">
                    work
                  </span>
</div>
<input class="block w-full rounded-lg border-gray-300 pl-10 py-3 text-lg placeholder:text-gray-400 focus:border-primary-500 focus:ring-primary-500" id="job-title" name="job-title" placeholder="Job Title" type="text" required/>
</div>
</div>
<div>
<label class="sr-only" for="job-description">Job Description</label>
<div class="relative">
<div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 pt-3">
<span class="material-symbols-outlined text-gray-400">
                    description
                  </span>
</div>
<textarea class="block w-full rounded-lg border-gray-300 pl-10 py-3 text-lg placeholder:text-gray-400 focus:border-primary-500 focus:ring-primary-500" id="job-description" name="job-description" placeholder="Job Description" rows="4" required></textarea>
</div>
</div>
<div>
<label class="sr-only" for="location">Location</label>
<div class="relative">
<div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
<span class="material-symbols-outlined text-gray-400">
                    location_on
                  </span>
</div>
<input class="block w-full rounded-lg border-gray-300 pl-10 py-3 text-lg placeholder:text-gray-400 focus:border-primary-500 focus:ring-primary-500" id="location" name="location" placeholder="Location" type="text" required/>
</div>
</div>
<div>
<label class="sr-only" for="work-type">Work Type</label>
<div class="relative">
<div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
<span class="material-symbols-outlined text-gray-400">
                    work_history
                  </span>
</div>
<select class="block w-full appearance-none rounded-lg border-gray-300 pl-10 pr-10 py-3 text-lg text-gray-900 focus:border-primary-500 focus:outline-none focus:ring-primary-500" id="work-type" name="work-type" required>
<option value="">Select work type</option>
<option>Full-time</option>
<option>Part-time</option>
<option>Freelance</option>
<option>Volunteer</option>
</select>
<div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
<span class="material-symbols-outlined">
                    expand_more
                  </span>
</div>
</div>
</div>
<div>
<label class="sr-only" for="salary">Salary / Payment</label>
<div class="relative">
<div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
<span class="material-symbols-outlined text-gray-400">
                    payments
                  </span>
</div>
<input class="block w-full rounded-lg border-gray-300 pl-10 py-3 text-lg placeholder:text-gray-400 focus:border-primary-500 focus:ring-primary-500" id="salary" name="salary" placeholder="Salary / Payment" type="text" required/>
</div>
</div>
<div>
<label class="sr-only" for="contact-info">Contact Info</label>
<div class="relative">
<div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
<span class="material-symbols-outlined text-gray-400">
                    contact_phone
                  </span>
</div>
<input class="block w-full rounded-lg border-gray-300 pl-10 py-3 text-lg placeholder:text-gray-400 focus:border-primary-500 focus:ring-primary-500" id="contact-info" name="contact-info" placeholder="Phone, Email, LINE ID" type="text" required/>
</div>
</div>
<div class="pt-4 space-y-4">
<button class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-xl font-semibold text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" type="submit">Submit Job</button>
<button onclick="goBackToDashboard()" class="w-full flex justify-center py-3 px-4 border border-gray-300 rounded-lg shadow-sm text-xl font-semibold text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500" type="button">Back to Dashboard</button>
</div>
</form>
</div>
</main>
<footer class="bg-white border-t border-gray-200">
<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
<nav class="flex justify-center space-x-6 mb-4">
<a class="text-gray-500 hover:text-gray-700" href="index.html">Home</a>
<a class="text-gray-500 hover:text-gray-700" href="jobs.html">Jobs</a>
<a class="text-gray-500 hover:text-gray-700" href="post-job.html">Post a Job</a>
<a class="text-gray-500 hover:text-gray-700" href="register.html">Register</a>
<a class="text-gray-500 hover:text-gray-700" href="contact.html">Contact</a>
</nav>
<div class="flex justify-center space-x-6">
<a class="text-gray-400 hover:text-gray-500" href="#">
<span class="sr-only">Facebook</span>
<svg aria-hidden="true" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
<path clip-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" fill-rule="evenodd"></path>
</svg>
</a>
<a class="text-gray-400 hover:text-gray-500" href="#">
<span class="sr-only">Twitter</span>
<svg aria-hidden="true" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
<path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.71v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path>
</svg>
</a>
<a class="text-gray-400 hover:text-gray-500" href="#">
<span class="sr-only">LinkedIn</span>
<svg aria-hidden="true" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
<path clip-rule="evenodd" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14zm-11.5 6a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-1.5 2.5a1.5 1.5 0 0 0-1.5 1.5v5a1.5 1.5 0 0 0 3 0v-5a1.5 1.5 0 0 0-1.5-1.5zM16.5 9a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-1.5 2.5a1.5 1.5 0 0 0-1.5 1.5v5a1.5 1.5 0 0 0 3 0v-5a1.5 1.5 0 0 0-1.5-1.5z" fill-rule="evenodd"></path>
</svg>
</a>
</div>
<p class="mt-8 text-center text-base text-gray-400">© 2024 KaoJob. All rights reserved.</p>
</div>
</footer>
</div>

<script>
// Database management functions
function initializeDatabase() {
  // Initialize jobs database if it doesn't exist
  if (!localStorage.getItem('kaoJobJobs')) {
    const initialJobs = [
      {
        id: 'job_001',
        title: 'Barista',
        description: 'Part-time coffee shop position. Perfect for seniors who enjoy customer service and have experience in hospitality.',
        location: 'Bangkok',
        workType: 'Part-time',
        salary: '฿15,000 - ฿18,000/month',
        contactInfo: 'contact@greencafe.com',
        employerId: 'emp_001',
        employerName: 'Demo Employer',
        status: 'Active',
        datePosted: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(), // 7 days ago
        applications: ['app_001', 'app_002']
      },
      {
        id: 'job_002',
        title: 'Office Assistant',
        description: 'Full-time administrative support position. Looking for experienced professionals with excellent organizational skills.',
        location: 'Bangkok',
        workType: 'Full-time',
        salary: '฿20,000/month',
        contactInfo: 'hr@bangkokoffice.com',
        employerId: 'emp_001',
        employerName: 'Demo Employer',
        status: 'Active',
        datePosted: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(), // 3 days ago
        applications: ['app_003']
      },
      {
        id: 'job_003',
        title: 'Gardener',
        description: 'Freelance gardening work with flexible hours and competitive pay. Perfect for seniors who love working outdoors.',
        location: 'Chiang Mai',
        workType: 'Freelance',
        salary: '฿500/day',
        contactInfo: 'gardens@citygreen.com',
        employerId: 'emp_001',
        employerName: 'Demo Employer',
        status: 'Closed',
        datePosted: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(), // 14 days ago
        applications: ['app_004']
      }
    ];
    localStorage.setItem('kaoJobJobs', JSON.stringify(initialJobs));
  }

  // Initialize applications database
  if (!localStorage.getItem('kaoJobApplications')) {
    const initialApplications = [
      {
        id: 'app_001',
        jobId: 'job_001',
        jobTitle: 'Barista',
        applicantId: 'js_001',
        applicantName: 'Demo Job Seeker',
        applicantEmail: 'jobseeker@kaojob.com',
        employerId: 'emp_001',
        status: 'Under Review',
        dateApplied: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(), // 2 days ago
        experience: '15 years in customer service'
      },
      {
        id: 'app_002',
        jobId: 'job_001',
        jobTitle: 'Barista',
        applicantId: 'js_002',
        applicantName: 'Malee Kaewkerd',
        applicantEmail: 'malee.k@email.com',
        employerId: 'emp_001',
        status: 'Interview Scheduled',
        dateApplied: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(), // 3 days ago
        experience: '20 years in hospitality'
      },
      {
        id: 'app_003',
        jobId: 'job_002',
        jobTitle: 'Office Assistant',
        applicantId: 'js_003',
        applicantName: 'Somchai Jaidee',
        applicantEmail: 'somchai.j@email.com',
        employerId: 'emp_001',
        status: 'Pending',
        dateApplied: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(), // 2 days ago
        experience: '15 years in office administration'
      },
      {
        id: 'app_004',
        jobId: 'job_003',
        jobTitle: 'Gardener',
        applicantId: 'js_004',
        applicantName: 'Prapai Suksan',
        applicantEmail: 'prapai.s@email.com',
        employerId: 'emp_001',
        status: 'Not Selected',
        dateApplied: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(), // 7 days ago
        experience: '12 years in landscaping'
      }
    ];
    localStorage.setItem('kaoJobApplications', JSON.stringify(initialApplications));
  }
}

function generateId(prefix) {
  return prefix + '_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

function addJob(jobData) {
  const jobs = JSON.parse(localStorage.getItem('kaoJobJobs') || '[]');
  const userSession = JSON.parse(localStorage.getItem('kaoJobUser'));
  
  const newJob = {
    id: generateId('job'),
    title: jobData.title,
    description: jobData.description,
    location: jobData.location,
    workType: jobData.workType,
    salary: jobData.salary,
    contactInfo: jobData.contactInfo,
    employerId: userSession.id,
    employerName: userSession.name,
    status: 'Active',
    datePosted: new Date().toISOString(),
    applications: []
  };
  
  jobs.push(newJob);
  localStorage.setItem('kaoJobJobs', JSON.stringify(jobs));
  return newJob;
}

function toggleMobileMenu() {
  const menu = document.getElementById('mobile-menu');
  menu.classList.toggle('hidden');
}

function goBackToDashboard() {
  const userSession = localStorage.getItem('kaoJobUser');
  if (userSession) {
    const user = JSON.parse(userSession);
    if (user.type === 'employer') {
      window.location.href = 'dashboard-employer.html';
    } else {
      window.location.href = 'dashboard-jobseeker.html';
    }
  } else {
    window.location.href = 'index.html';
  }
}

async function handleJobSubmit(event) {
  event.preventDefault();
  const formData = new FormData(event.target);

  const jobData = {
    title: formData.get('job-title'),
    description: formData.get('job-description'),
    location: formData.get('location'),
    workType: formData.get('work-type'),
    salary: formData.get('salary'),
    contactInfo: formData.get('contact-info')
  };

  const token = localStorage.getItem('kaoJobToken');
  if (token) {
    try {
      const res = await fetch('/api/jobs', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
        body: JSON.stringify(jobData)
      });
      const data = await res.json();
      if (!res.ok) {
        showMessage(`Failed to post job: ${data.error || 'server error'}`, 'error');
        return;
      }
  showMessage(`Job "${jobData.title}" has been posted successfully! Redirecting to your dashboard...`);
      setTimeout(() => {
        event.target.reset();
        goBackToDashboard();
      }, 1400);
      return;
    } catch (err) {
      console.error(err);
      showMessage('Network error while posting job, saving locally for demo.', 'error');
    }
  }

  // Fallback: save locally (offline/demo)
  const newJob = addJob(jobData);
  showMessage(`Job "${jobData.title}" saved locally (demo mode). Redirecting to your dashboard...`);
  setTimeout(() => {
    event.target.reset();
    goBackToDashboard();
  }, 1200);
}

function showMessage(text, type = 'success') {
  const messageDiv = document.createElement('div');
  const bgColor = type === 'error' ? 'bg-red-500' : 'bg-green-500';
  messageDiv.className = `fixed top-20 left-1/2 transform -translate-x-1/2 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-md text-center`;
  messageDiv.textContent = text;
  document.body.appendChild(messageDiv);
  
  setTimeout(() => {
    messageDiv.remove();
  }, 4000);
}

// Close mobile menu when clicking outside
document.addEventListener('click', function(event) {
  const menu = document.getElementById('mobile-menu');
  const menuButton = event.target.closest('button');
  
  if (!menu.contains(event.target) && !menuButton) {
    menu.classList.add('hidden');
  }
});

// Check authentication on page load
window.addEventListener('load', function() {
  const userSession = localStorage.getItem('kaoJobUser');
  if (!userSession) {
    showMessage('Please log in to post a job.', 'error');
    setTimeout(() => {
      window.location.href = 'login.html';
    }, 2000);
    return;
  }
  
  const user = JSON.parse(userSession);
  if (!user.isLoggedIn) {
    showMessage('Please log in to post a job.', 'error');
    setTimeout(() => {
      window.location.href = 'login.html';
    }, 2000);
    return;
  }

  // Initialize database
  initializeDatabase();
});
</script>
</body>
</html>
