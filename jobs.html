<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      min-height: max(884px, 100dvh);
    }
    
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .animate-fade-in-up {
      animation: fadeInUp 0.6s ease-out forwards;
      opacity: 0;
    }
  </style><meta charset="utf-8"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Public+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
  <title>Browse Jobs - KaoJob</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<style type="text/tailwindcss">
      :root {
        --primary-50: #f0fdf4;
        --primary-100: #dcfce7;
        --primary-200: #bbf7d0;
        --primary-300: #86efac;
        --primary-400: #4ade80;
        --primary-500: #22c55e;
        --primary-600: #16a34a;
        --primary-700: #15803d;
        --primary-800: #166534;
        --primary-900: #14532d;
        --primary-950: #052e16;
      }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-gray-50">
<div class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden" style='font-family: "Public Sans", "Noto Sans", sans-serif;'>
<header class="flex items-center bg-white p-4 justify-between sticky top-0 z-20 shadow-sm">
<a class="text-xl font-bold text-gray-800" href="index.html">KaoJob</a>
<button class="flex items-center justify-center rounded-md h-10 w-10 bg-transparent text-gray-700" onclick="toggleMobileMenu()">
<span class="material-symbols-outlined">
              menu
            </span>
</button>
<div id="mobile-menu" class="hidden absolute top-16 right-4 bg-white rounded-lg shadow-lg p-4 z-30">
<nav class="flex flex-col space-y-2">
<a class="text-gray-700 hover:text-green-600 px-3 py-2" href="index.html">Home</a>
<a class="text-gray-700 hover:text-green-600 px-3 py-2" href="jobs.html">Jobs</a>
<a class="text-gray-700 hover:text-green-600 px-3 py-2" href="post-job.html">Post a Job</a>
<a class="text-gray-700 hover:text-green-600 px-3 py-2" href="register.html">Register</a>
<a class="text-gray-700 hover:text-green-600 px-3 py-2" href="contact.html">Contact</a>
<div class="border-t border-gray-200 mt-2 pt-2">
<a class="text-red-600 hover:text-red-700 px-3 py-2 flex items-center text-sm" href="dev-export.html">
<span class="material-symbols-outlined text-sm mr-2">code</span>
Export API
</a>
</div>
</nav>
</div>
</header>
<main class="flex-grow bg-gray-100 py-8 px-4 sm:px-6 lg:px-8">
<div class="max-w-6xl mx-auto">
<!-- Navigation Breadcrumb -->
<nav class="flex items-center space-x-2 text-sm mb-6" aria-label="Breadcrumb">
<a href="index.html" class="text-gray-500 hover:text-gray-700 flex items-center">
<span class="material-symbols-outlined text-sm mr-1">home</span>
Home
</a>
<span class="text-gray-400">/</span>
<span class="text-gray-900 font-medium">Browse Jobs</span>
</nav>

<div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8">
<div>
<h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">Browse Jobs</h1>
<p class="text-gray-600">Find your perfect job opportunity from our latest listings</p>
</div>
<div class="mt-4 lg:mt-0 flex flex-wrap gap-2">
<button onclick="goBackToDashboard()" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors">
<span class="material-symbols-outlined text-sm mr-2">arrow_back</span>
Back to Dashboard
</button>
<a href="post-job.html" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 transition-colors">
<span class="material-symbols-outlined text-sm mr-2">add</span>
Post a Job
</a>
</div>
</div>

<!-- Search and Filters -->
<div class="bg-white rounded-lg shadow-sm p-6 mb-8">
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div>
<label for="search-input" class="block text-sm font-medium text-gray-700 mb-2">Search Jobs</label>
<div class="relative">
<div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
<span class="material-symbols-outlined text-gray-400 text-sm">search</span>
</div>
<input 
id="search-input" 
name="search" 
type="search"
class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500" 
placeholder="Job title, company, keywords..."
/>
</div>
</div>
<div>
<label for="location-filter" class="block text-sm font-medium text-gray-700 mb-2">Location</label>
<select id="location-filter" class="block w-full py-2 px-3 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
<option value="">All Locations</option>
<option value="Bangkok">Bangkok</option>
<option value="Chiang Mai">Chiang Mai</option>
<option value="Phuket">Phuket</option>
<option value="Pattaya">Pattaya</option>
</select>
</div>
<div>
<label for="type-filter" class="block text-sm font-medium text-gray-700 mb-2">Job Type</label>
<select id="type-filter" class="block w-full py-2 px-3 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
<option value="">All Types</option>
<option value="Full-time">Full-time</option>
<option value="Part-time">Part-time</option>
<option value="Freelance">Freelance</option>
<option value="Contract">Contract</option>
</select>
</div>
</div>
</div>

<div id="job-list" class="space-y-6">
<div class="job-card bg-white rounded-xl shadow-md overflow-hidden" data-job="barista bangkok part-time active">
<div class="p-6">
<div class="flex justify-between items-start">
<div class="flex-grow">
<div class="flex items-center justify-between">
<h2 class="text-xl font-bold text-gray-900">Barista</h2>
<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Active</span>
</div>
<div class="mt-2 text-gray-500 space-y-1">
<div class="flex items-center">
<span class="material-symbols-outlined text-sm mr-1.5">location_on</span>
<span>Bangkok</span>
</div>
<div class="flex items-center">
<span class="material-symbols-outlined text-sm mr-1.5">work</span>
<span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">Part-time</span>
</div>
<div class="flex items-center">
<span class="material-symbols-outlined text-sm mr-1.5">payments</span>
<span>฿15,000 - ฿18,000/month</span>
</div>
</div>
</div>
</div>
<div class="mt-4 flex justify-end space-x-2">
<button onclick="editJob('barista')" class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
<span class="material-symbols-outlined text-base mr-1.5 -ml-0.5">edit</span> Edit
                </button>
<button onclick="deleteJob(this, 'barista')" class="inline-flex items-center px-3 py-1.5 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700">
<span class="material-symbols-outlined text-base mr-1.5 -ml-0.5">delete</span> Delete
                </button>
</div>
</div>
</div>
<div class="job-card bg-white rounded-xl shadow-md overflow-hidden" data-job="gardener chiang mai freelance closed">
<div class="p-6">
<div class="flex justify-between items-start">
<div class="flex-grow">
<div class="flex items-center justify-between">
<h2 class="text-xl font-bold text-gray-900">Gardener</h2>
<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-800">Closed</span>
</div>
<div class="mt-2 text-gray-500 space-y-1">
<div class="flex items-center">
<span class="material-symbols-outlined text-sm mr-1.5">location_on</span>
<span>Chiang Mai</span>
</div>
<div class="flex items-center">
<span class="material-symbols-outlined text-sm mr-1.5">work</span>
<span class="inline-block bg-purple-100 text-purple-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">Freelance</span>
</div>
<div class="flex items-center">
<span class="material-symbols-outlined text-sm mr-1.5">payments</span>
<span>฿500/day</span>
</div>
</div>
</div>
</div>
<div class="mt-4 flex justify-end space-x-2">
<button onclick="editJob('gardener')" class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
<span class="material-symbols-outlined text-base mr-1.5 -ml-0.5">edit</span> Edit
                </button>
<button onclick="deleteJob(this, 'gardener')" class="inline-flex items-center px-3 py-1.5 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700">
<span class="material-symbols-outlined text-base mr-1.5 -ml-0.5">delete</span> Delete
                </button>
</div>
</div>
</div>
<div class="job-card bg-white rounded-xl shadow-md overflow-hidden" data-job="office assistant bangkok full-time active">
<div class="p-6">
<div class="flex justify-between items-start">
<div class="flex-grow">
<div class="flex items-center justify-between">
<h2 class="text-xl font-bold text-gray-900">Office Assistant</h2>
<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Active</span>
</div>
<div class="mt-2 text-gray-500 space-y-1">
<div class="flex items-center">
<span class="material-symbols-outlined text-sm mr-1.5">location_on</span>
<span>Bangkok</span>
</div>
<div class="flex items-center">
<span class="material-symbols-outlined text-sm mr-1.5">work</span>
<span class="inline-block bg-indigo-100 text-indigo-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">Full-time</span>
</div>
<div class="flex items-center">
<span class="material-symbols-outlined text-sm mr-1.5">payments</span>
<span>฿20,000/month</span>
</div>
</div>
</div>
</div>
<div class="mt-4 flex justify-end space-x-2">
<button onclick="editJob('office-assistant')" class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
<span class="material-symbols-outlined text-base mr-1.5 -ml-0.5">edit</span> Edit
                </button>
<button onclick="deleteJob(this, 'office-assistant')" class="inline-flex items-center px-3 py-1.5 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700">
<span class="material-symbols-outlined text-base mr-1.5 -ml-0.5">delete</span> Delete
                </button>
</div>
</div>
</div>
</div>
</div>
</main>
<footer class="bg-white border-t border-gray-200">
<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
<nav class="flex justify-center space-x-6 mb-4">
<a class="text-gray-500 hover:text-gray-700" href="index.html">Home</a>
<a class="text-gray-500 hover:text-gray-700" href="jobs.html">Jobs</a>
<a class="text-gray-500 hover:text-gray-700" href="post-job.html">Post a Job</a>
<a class="text-gray-500 hover:text-gray-700" href="register.html">Register</a>
<a class="text-gray-500 hover:text-gray-700" href="contact.html">Contact</a>
</nav>
<div class="flex justify-center space-x-6">
<a class="text-gray-400 hover:text-gray-500" href="#">
<span class="sr-only">Facebook</span>
<svg aria-hidden="true" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
<path clip-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" fill-rule="evenodd"></path>
</svg>
</a>
<a class="text-gray-400 hover:text-gray-500" href="#">
<span class="sr-only">Twitter</span>
<svg aria-hidden="true" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
<path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.71v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path>
</svg>
</a>
<a class="text-gray-400 hover:text-gray-500" href="#">
<span class="sr-only">LinkedIn</span>
<svg aria-hidden="true" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
<path clip-rule="evenodd" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14zm-11.5 6a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-1.5 2.5a1.5 1.5 0 0 0-1.5 1.5v5a1.5 1.5 0 0 0 3 0v-5a1.5 1.5 0 0 0-1.5-1.5zM16.5 9a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-1.5 2.5a1.5 1.5 0 0 0-1.5 1.5v5a1.5 1.5 0 0 0 3 0v-5a1.5 1.5 0 0 0-1.5-1.5z" fill-rule="evenodd"></path>
</svg>
</a>
</div>
<p class="mt-8 text-center text-base text-gray-400">© 2024 KaoJob. All rights reserved.</p>
</div>
</footer>
</div>

<!-- Application Modal -->
<div id="applicationModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
  <div class="relative top-20 mx-auto p-5 border w-full max-w-lg shadow-lg rounded-lg bg-white">
    <div class="mt-3">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-gray-900" id="modalJobTitle">Apply for Position</h3>
        <button onclick="closeApplicationModal()" class="text-gray-400 hover:text-gray-600">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      
      <div class="mb-4">
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
          <div class="flex items-start">
            <div class="flex-shrink-0">
              <span class="material-symbols-outlined text-blue-600">info</span>
            </div>
            <div class="ml-3">
              <h4 class="text-sm font-medium text-blue-900">Application Tips</h4>
              <p class="text-sm text-blue-700 mt-1">Highlight relevant experience, skills, and achievements that match this position.</p>
            </div>
          </div>
        </div>
        
        <form id="applicationForm">
          <div class="mb-4">
            <label for="applicantExperience" class="block text-sm font-medium text-gray-700 mb-2">
              Relevant Experience & Skills
            </label>
            <textarea 
              id="applicantExperience" 
              name="experience" 
              rows="4" 
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 resize-none"
              placeholder="Describe your relevant experience, skills, and why you're a great fit for this position..."
              maxlength="500"
            ></textarea>
            <div class="flex justify-between items-center mt-1">
              <p class="text-xs text-gray-500">Be specific and mention relevant achievements</p>
              <span id="charCount" class="text-xs text-gray-400">0/500</span>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="flex items-center">
              <input type="checkbox" id="agreeTerms" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
              <span class="ml-2 text-sm text-gray-600">I agree to share my profile information with the employer</span>
            </label>
          </div>
          
          <div class="flex space-x-3">
            <button 
              type="button" 
              onclick="closeApplicationModal()" 
              class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button 
              type="submit" 
              class="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed"
              disabled
            >
              Submit Application
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
// Database management functions
function getJobsFromDatabase() {
  return JSON.parse(localStorage.getItem('kaoJobJobs') || '[]');
}

function getApplicationsFromDatabase() {
  return JSON.parse(localStorage.getItem('kaoJobApplications') || '[]');
}

function addApplicationToDatabase(applicationData) {
  try {
    const applications = getApplicationsFromDatabase();
    const userSession = JSON.parse(localStorage.getItem('kaoJobUser'));
    
    if (!userSession || !userSession.id) {
      throw new Error('User session not found');
    }
    
    const newApplication = {
      id: generateId('app'),
      jobId: applicationData.jobId,
      jobTitle: applicationData.jobTitle,
      applicantId: userSession.id,
      applicantName: userSession.name,
      applicantEmail: userSession.email,
      employerId: applicationData.employerId,
      status: 'Pending',
      dateApplied: new Date().toISOString(),
      experience: applicationData.experience || 'Not specified'
    };
    
    applications.push(newApplication);
    localStorage.setItem('kaoJobApplications', JSON.stringify(applications));
    
    // Add application ID to job's applications array
    const jobs = getJobsFromDatabase();
    const jobIndex = jobs.findIndex(job => job.id === applicationData.jobId);
    if (jobIndex !== -1) {
      if (!jobs[jobIndex].applications) {
        jobs[jobIndex].applications = [];
      }
      jobs[jobIndex].applications.push(newApplication.id);
      localStorage.setItem('kaoJobJobs', JSON.stringify(jobs));
    }
    
    return newApplication;
  } catch (error) {
    console.error('Error adding application to database:', error);
    throw error;
  }
}

function generateId(prefix) {
  return prefix + '_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

function hasUserApplied(jobId) {
  const userSession = localStorage.getItem('kaoJobUser');
  if (!userSession) return false;
  
  const user = JSON.parse(userSession);
  const applications = getApplicationsFromDatabase();
  return applications.some(app => app.jobId === jobId && app.applicantId === user.id);
}

function renderJobs(jobsToRender = null) {
  const jobsContainer = document.getElementById('job-list');
  const jobs = jobsToRender || getJobsFromDatabase();
  console.log('Rendering jobs:', jobs.length, 'total jobs found');
  
  const activeJobs = jobs.filter(job => job.status === 'Active');
  console.log('Active jobs:', activeJobs.length, 'jobs');
  
  const userSession = localStorage.getItem('kaoJobUser');
  const currentUser = userSession ? JSON.parse(userSession) : null;
  
  // Show loading state
  jobsContainer.innerHTML = `
    <div class="flex justify-center items-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"></div>
    </div>
  `;
  
  // Simulate loading delay for better UX
  setTimeout(() => {
    if (activeJobs.length === 0) {
      jobsContainer.innerHTML = `
        <div class="text-center py-16">
          <div class="mx-auto h-24 w-24 text-gray-400 mb-6">
            <span class="material-symbols-outlined text-6xl">work_off</span>
          </div>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No jobs found</h3>
          <p class="text-gray-500 mb-6">Try adjusting your search criteria or check back later for new opportunities.</p>
          <button onclick="window.location.reload()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">
            <span class="material-symbols-outlined text-sm mr-2">refresh</span>
            Refresh Jobs
          </button>
        </div>
      `;
      return;
    }
    
    jobsContainer.innerHTML = activeJobs.map((job, index) => {
      const hasApplied = currentUser && hasUserApplied(job.id);
      const isEmployer = currentUser && currentUser.type === 'employer';
      const isOwnJob = isEmployer && currentUser.id === job.employerId;
      
      // Add stagger animation class
      const animationDelay = `style="animation-delay: ${index * 0.1}s"`;
      
      return `
        <div class="job-card bg-white rounded-xl shadow-sm hover:shadow-md transition-all duration-300 border border-gray-100 animate-fade-in-up" ${animationDelay}>
          <div class="p-6">
            <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between">
              <div class="flex-1 mb-4 lg:mb-0 lg:mr-6">
                <div class="flex items-start justify-between mb-3">
                  <div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-1">${job.title}</h3>
                    <p class="text-gray-600 font-medium">${job.employerName}</p>
                  </div>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    <span class="w-1.5 h-1.5 bg-green-500 rounded-full mr-1.5"></span>
                    Active
                  </span>
                </div>
                
                <div class="flex flex-wrap items-center gap-4 mb-3 text-sm text-gray-600">
                  <div class="flex items-center">
                    <span class="material-symbols-outlined text-sm mr-1.5 text-gray-500">location_on</span>
                    <span>${job.location}</span>
                  </div>
                  <div class="flex items-center">
                    <span class="material-symbols-outlined text-sm mr-1.5 text-gray-500">work</span>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-blue-100 text-blue-800">${job.workType}</span>
                  </div>
                  <div class="flex items-center text-green-600 font-semibold">
                    <span class="material-symbols-outlined text-sm mr-1.5">payments</span>
                    <span>${job.salary}</span>
                  </div>
                </div>
                
                <p class="text-gray-700 mb-4 line-clamp-2">${job.description}</p>
                
                <div class="flex items-center justify-between text-sm text-gray-500">
                  <div class="flex items-center">
                    <span class="material-symbols-outlined text-sm mr-1">email</span>
                    <span>${job.contactInfo}</span>
                  </div>
                  <div class="flex items-center space-x-4">
                    ${job.applications.length > 0 ? `
                      <div class="flex items-center">
                        <span class="material-symbols-outlined text-sm mr-1">group</span>
                        <span>${job.applications.length} applications</span>
                      </div>
                    ` : ''}
                    <span>${new Date(job.datePosted).toLocaleDateString()}</span>
                  </div>
                </div>
              </div>
              
              <div class="flex flex-col space-y-2 lg:flex-shrink-0">
                ${currentUser && currentUser.isLoggedIn ? 
                  (isOwnJob ? 
                    `<button onclick="editJob('${job.id}')" class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                      <span class="material-symbols-outlined text-sm mr-2">edit</span>
                      Edit Job
                    </button>
                    <button onclick="deleteJob('${job.id}', '${job.title}')" class="inline-flex items-center justify-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 transition-colors">
                      <span class="material-symbols-outlined text-sm mr-2">delete</span>
                      Delete
                    </button>` :
                    (hasApplied ?
                      `<div class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-500 bg-gray-100 cursor-not-allowed">
                        <span class="material-symbols-outlined text-sm mr-2">check_circle</span>
                        Applied
                      </div>` :
                      `<button onclick="applyForJob('${job.id}', '${job.title}', '${job.employerId}')" class="inline-flex items-center justify-center px-6 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 transition-all duration-200 transform hover:scale-105">
                        <span class="material-symbols-outlined text-sm mr-2">send</span>
                        Apply Now
                      </button>`
                    )
                  ) :
                  `<a href="login.html" class="inline-flex items-center justify-center px-6 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                    <span class="material-symbols-outlined text-sm mr-2">login</span>
                    Login to Apply
                  </a>`
                }
              </div>
            </div>
          </div>
        </div>
      `;
    }).join('');
  }, 300); // 300ms loading delay
}

let currentJobApplication = null;

function applyForJob(jobId, jobTitle, employerId) {
  const userSession = localStorage.getItem('kaoJobUser');
  if (!userSession) {
    showMessage('Please log in to apply for jobs.', 'error');
    window.location.href = 'login.html';
    return;
  }

  const user = JSON.parse(userSession);
  if (user.type !== 'jobseeker') {
    showMessage('Only job seekers can apply for jobs.', 'error');
    return;
  }

  if (hasUserApplied(jobId)) {
    showMessage('You have already applied for this job.', 'error');
    return;
  }

  // Store current application details
  currentJobApplication = {
    jobId: jobId,
    jobTitle: jobTitle,
    employerId: employerId
  };

  // Show modal
  document.getElementById('modalJobTitle').textContent = `Apply for ${jobTitle}`;
  document.getElementById('applicationModal').classList.remove('hidden');
  document.getElementById('applicantExperience').focus();
}

function closeApplicationModal() {
  document.getElementById('applicationModal').classList.add('hidden');
  document.getElementById('applicationForm').reset();
  document.getElementById('charCount').textContent = '0/500';
  document.querySelector('#applicationForm button[type="submit"]').disabled = true;
  currentJobApplication = null;
}

function submitApplication() {
  if (!currentJobApplication) return;

  const experience = document.getElementById('applicantExperience').value.trim();
  const agreeTerms = document.getElementById('agreeTerms').checked;

  if (!experience) {
    showMessage('Please describe your relevant experience.', 'error');
    return;
  }

  if (!agreeTerms) {
    showMessage('Please agree to share your profile information.', 'error');
    return;
  }

  const applicationData = {
    jobId: currentJobApplication.jobId,
    jobTitle: currentJobApplication.jobTitle,
    employerId: currentJobApplication.employerId,
    experience: experience
  };

  try {
    // Disable the submit button to prevent double submission
    const submitBtn = document.querySelector('#applicationForm button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></span>Submitting...';

    addApplicationToDatabase(applicationData);
    closeApplicationModal();
    showMessage(`Application submitted successfully for "${currentJobApplication.jobTitle}"! The employer will review your application.`, 'success');
    
    // Re-render jobs to update button state
    setTimeout(() => {
      renderJobs();
    }, 1000);
    
  } catch (error) {
    console.error('Application submission error:', error);
    showMessage('Failed to submit application. Please try again.', 'error');
    
    // Re-enable the submit button
    const submitBtn = document.querySelector('#applicationForm button[type="submit"]');
    if (submitBtn) {
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'Submit Application';
    }
  }
}

// Character counter and validation
document.addEventListener('DOMContentLoaded', function() {
  const textarea = document.getElementById('applicantExperience');
  const charCount = document.getElementById('charCount');
  const submitBtn = document.querySelector('#applicationForm button[type="submit"]');
  const agreeCheckbox = document.getElementById('agreeTerms');
  
  if (textarea && charCount) {
    textarea.addEventListener('input', function() {
      const length = this.value.length;
      charCount.textContent = `${length}/500`;
      
      // Update submit button state
      const hasText = length > 0;
      const hasAgreed = agreeCheckbox && agreeCheckbox.checked;
      submitBtn.disabled = !(hasText && hasAgreed);
    });
  }
  
  if (agreeCheckbox) {
    agreeCheckbox.addEventListener('change', function() {
      const hasText = textarea && textarea.value.trim().length > 0;
      const hasAgreed = this.checked;
      submitBtn.disabled = !(hasText && hasAgreed);
    });
  }
  
  // Form submission
  const form = document.getElementById('applicationForm');
  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      submitApplication();
    });
  }
  
  // Add search event listeners
  const searchInput = document.getElementById('search-input');
  const locationFilter = document.getElementById('location-filter');
  const typeFilter = document.getElementById('type-filter');
  
  if (searchInput) {
    searchInput.addEventListener('input', searchJobs);
  }
  
  if (locationFilter) {
    locationFilter.addEventListener('change', searchJobs);
  }
  
  if (typeFilter) {
    typeFilter.addEventListener('change', searchJobs);
  }
});

function toggleMobileMenu() {
  const menu = document.getElementById('mobile-menu');
  menu.classList.toggle('hidden');
}

function goBackToDashboard() {
  const userSession = localStorage.getItem('kaoJobUser');
  if (userSession) {
    const user = JSON.parse(userSession);
    if (user.type === 'employer') {
      window.location.href = 'dashboard-employer.html';
    } else if (user.type === 'jobseeker') {
      window.location.href = 'dashboard-jobseeker.html';
    } else {
      window.location.href = 'index.html';
    }
  } else {
    window.location.href = 'index.html';
  }
}

function searchJobs() {
  const searchTerm = document.getElementById('search-input').value.toLowerCase();
  const locationFilter = document.getElementById('location-filter').value;
  const typeFilter = document.getElementById('type-filter').value;
  
  const allJobs = getJobsFromDatabase();
  const filteredJobs = allJobs.filter(job => {
    const matchesSearch = !searchTerm || 
      job.title.toLowerCase().includes(searchTerm) ||
      job.description.toLowerCase().includes(searchTerm) ||
      job.employerName.toLowerCase().includes(searchTerm);
    
    const matchesLocation = !locationFilter || job.location === locationFilter;
    const matchesType = !typeFilter || job.workType === typeFilter;
    
    return matchesSearch && matchesLocation && matchesType && job.status === 'Active';
  });
  
  renderJobs(filteredJobs);
}

function editJob(jobId) {
  showMessage('Edit functionality coming soon!');
  // In a real app, this would navigate to an edit form
}

function deleteJob(jobId, jobTitle) {
  if (confirm(`Are you sure you want to delete the "${jobTitle}" job posting?`)) {
    const jobs = getJobsFromDatabase();
    const updatedJobs = jobs.filter(job => job.id !== jobId);
    localStorage.setItem('kaoJobJobs', JSON.stringify(updatedJobs));
    showMessage(`"${jobTitle}" job posting deleted successfully.`);
    renderJobs();
  }
}

function showMessage(text, type = 'success') {
  const messageDiv = document.createElement('div');
  let bgColor;
  switch(type) {
    case 'error':
      bgColor = 'bg-red-500';
      break;
    case 'info':
      bgColor = 'bg-blue-500';
      break;
    default:
      bgColor = 'bg-green-500';
  }
  messageDiv.className = `fixed top-20 left-1/2 transform -translate-x-1/2 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-md text-center`;
  messageDiv.textContent = text;
  document.body.appendChild(messageDiv);
  
  setTimeout(() => {
    messageDiv.remove();
  }, 4000);
}

// Close mobile menu when clicking outside
document.addEventListener('click', function(event) {
  const menu = document.getElementById('mobile-menu');
  const menuButton = event.target.closest('button');
  
  if (!menu.contains(event.target) && !menuButton) {
    menu.classList.add('hidden');
  }
});

// Initialize page
window.addEventListener('load', function() {
  // Initialize sample jobs if database is empty
  initializeSampleJobs();
  renderJobs();
});

function initializeSampleJobs() {
  const existingJobs = getJobsFromDatabase();
  if (existingJobs.length === 0) {
    const sampleJobs = [
      {
        id: 'job_sample_1',
        title: 'Barista',
        description: 'Looking for an experienced barista to join our team. Must have knowledge of coffee brewing techniques and excellent customer service skills.',
        employerId: 'emp_sample_1',
        employerName: 'Coffee Corner',
        location: 'Bangkok',
        workType: 'Part-time',
        salary: '฿15,000 - ฿18,000/month',
        contactInfo: 'jobs@coffeecorner.com',
        status: 'Active',
        datePosted: new Date().toISOString(),
        applications: []
      },
      {
        id: 'job_sample_2',
        title: 'Office Assistant',
        description: 'Seeking a reliable office assistant to handle administrative tasks, filing, and customer support. Computer skills required.',
        employerId: 'emp_sample_2',
        employerName: 'Business Solutions Ltd',
        location: 'Bangkok',
        workType: 'Full-time',
        salary: '฿20,000/month',
        contactInfo: 'hr@businesssolutions.com',
        status: 'Active',
        datePosted: new Date().toISOString(),
        applications: []
      },
      {
        id: 'job_sample_3',
        title: 'Gardener',
        description: 'Experienced gardener needed for maintaining residential gardens. Knowledge of plant care and landscaping preferred.',
        employerId: 'emp_sample_3',
        employerName: 'Green Thumb Services',
        location: 'Chiang Mai',
        workType: 'Freelance',
        salary: '฿500/day',
        contactInfo: 'contact@greenthumb.com',
        status: 'Active',
        datePosted: new Date().toISOString(),
        applications: []
      }
    ];
    
    localStorage.setItem('kaoJobJobs', JSON.stringify(sampleJobs));
  }
}
</script>
</body>
</html>
